c20b21ff0a32ca233a70251210e27918
/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */

'use strict';

/**
 * Module dependencies.
 */
var merge = require('utils-merge');
var parseUrl = require('parseurl');
var qs = require('qs');

/**
 * @param {Object} options
 * @return {Function}
 * @api public
 */

module.exports = function query(options) {
  var opts = merge({}, options);
  var queryparse = qs.parse;
  if (typeof options === 'function') {
    queryparse = options;
    opts = undefined;
  }
  if (opts !== undefined && opts.allowPrototypes === undefined) {
    // back-compat for qs module
    opts.allowPrototypes = true;
  }
  return function query(req, res, next) {
    if (!req.query) {
      var val = parseUrl(req).query;
      req.query = queryparse(val, opts);
    }
    next();
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZXJnZSIsInJlcXVpcmUiLCJwYXJzZVVybCIsInFzIiwibW9kdWxlIiwiZXhwb3J0cyIsInF1ZXJ5Iiwib3B0aW9ucyIsIm9wdHMiLCJxdWVyeXBhcnNlIiwicGFyc2UiLCJ1bmRlZmluZWQiLCJhbGxvd1Byb3RvdHlwZXMiLCJyZXEiLCJyZXMiLCJuZXh0IiwidmFsIl0sInNvdXJjZXMiOlsicXVlcnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBleHByZXNzXG4gKiBDb3B5cmlnaHQoYykgMjAwOS0yMDEzIFRKIEhvbG93YXljaHVrXG4gKiBDb3B5cmlnaHQoYykgMjAxMyBSb21hbiBTaHR5bG1hblxuICogQ29weXJpZ2h0KGMpIDIwMTQtMjAxNSBEb3VnbGFzIENocmlzdG9waGVyIFdpbHNvblxuICogTUlUIExpY2Vuc2VkXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMuXG4gKi9cblxudmFyIG1lcmdlID0gcmVxdWlyZSgndXRpbHMtbWVyZ2UnKVxudmFyIHBhcnNlVXJsID0gcmVxdWlyZSgncGFyc2V1cmwnKTtcbnZhciBxcyA9IHJlcXVpcmUoJ3FzJyk7XG5cbi8qKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICogQGFwaSBwdWJsaWNcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHF1ZXJ5KG9wdGlvbnMpIHtcbiAgdmFyIG9wdHMgPSBtZXJnZSh7fSwgb3B0aW9ucylcbiAgdmFyIHF1ZXJ5cGFyc2UgPSBxcy5wYXJzZTtcblxuICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICBxdWVyeXBhcnNlID0gb3B0aW9ucztcbiAgICBvcHRzID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKG9wdHMgIT09IHVuZGVmaW5lZCAmJiBvcHRzLmFsbG93UHJvdG90eXBlcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gYmFjay1jb21wYXQgZm9yIHFzIG1vZHVsZVxuICAgIG9wdHMuYWxsb3dQcm90b3R5cGVzID0gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiBxdWVyeShyZXEsIHJlcywgbmV4dCl7XG4gICAgaWYgKCFyZXEucXVlcnkpIHtcbiAgICAgIHZhciB2YWwgPSBwYXJzZVVybChyZXEpLnF1ZXJ5O1xuICAgICAgcmVxLnF1ZXJ5ID0gcXVlcnlwYXJzZSh2YWwsIG9wdHMpO1xuICAgIH1cblxuICAgIG5leHQoKTtcbiAgfTtcbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQVk7O0FBRVo7QUFDQTtBQUNBO0FBRUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsYUFBYSxDQUFDO0FBQ2xDLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNsQyxJQUFJRSxFQUFFLEdBQUdGLE9BQU8sQ0FBQyxJQUFJLENBQUM7O0FBRXRCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUFHLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHLFNBQVNDLEtBQUtBLENBQUNDLE9BQU8sRUFBRTtFQUN2QyxJQUFJQyxJQUFJLEdBQUdSLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRU8sT0FBTyxDQUFDO0VBQzdCLElBQUlFLFVBQVUsR0FBR04sRUFBRSxDQUFDTyxLQUFLO0VBRXpCLElBQUksT0FBT0gsT0FBTyxLQUFLLFVBQVUsRUFBRTtJQUNqQ0UsVUFBVSxHQUFHRixPQUFPO0lBQ3BCQyxJQUFJLEdBQUdHLFNBQVM7RUFDbEI7RUFFQSxJQUFJSCxJQUFJLEtBQUtHLFNBQVMsSUFBSUgsSUFBSSxDQUFDSSxlQUFlLEtBQUtELFNBQVMsRUFBRTtJQUM1RDtJQUNBSCxJQUFJLENBQUNJLGVBQWUsR0FBRyxJQUFJO0VBQzdCO0VBRUEsT0FBTyxTQUFTTixLQUFLQSxDQUFDTyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxFQUFDO0lBQ25DLElBQUksQ0FBQ0YsR0FBRyxDQUFDUCxLQUFLLEVBQUU7TUFDZCxJQUFJVSxHQUFHLEdBQUdkLFFBQVEsQ0FBQ1csR0FBRyxDQUFDLENBQUNQLEtBQUs7TUFDN0JPLEdBQUcsQ0FBQ1AsS0FBSyxHQUFHRyxVQUFVLENBQUNPLEdBQUcsRUFBRVIsSUFBSSxDQUFDO0lBQ25DO0lBRUFPLElBQUksQ0FBQyxDQUFDO0VBQ1IsQ0FBQztBQUNILENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=