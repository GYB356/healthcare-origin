{"version":3,"names":["mongoose","require","MongoMemoryServer","mongod","beforeAll","console","log","create","instance","dbName","port","binary","version","uri","getUri","connect","serverSelectionTimeoutMS","socketTimeoutMS","connectTimeoutMS","error","afterEach","connection","readyState","collections","db","Promise","all","map","collection","deleteMany","afterAll","close","stop"],"sources":["mongodb.setup.js"],"sourcesContent":["const mongoose = require('mongoose');\r\nconst { MongoMemoryServer } = require('mongodb-memory-server');\r\n\r\nlet mongod = null;\r\n\r\n// Connect to the in-memory database before running tests\r\nbeforeAll(async () => {\r\n  try {\r\n    console.log('Starting MongoDB Memory Server...');\r\n    mongod = await MongoMemoryServer.create({\r\n      instance: {\r\n        dbName: 'jest',\r\n        port: 27017\r\n      },\r\n      binary: {\r\n        version: '6.0.4'\r\n      }\r\n    });\r\n    const uri = mongod.getUri();\r\n    console.log('Connecting to MongoDB Memory Server at:', uri);\r\n    \r\n    await mongoose.connect(uri, {\r\n      serverSelectionTimeoutMS: 30000,\r\n      socketTimeoutMS: 30000,\r\n      connectTimeoutMS: 30000\r\n    });\r\n    console.log('Successfully connected to MongoDB Memory Server');\r\n  } catch (error) {\r\n    console.error('Error setting up MongoDB Memory Server:', error);\r\n    throw error;\r\n  }\r\n}, 30000); // Increase timeout to 30 seconds\r\n\r\n// Clear all data between tests\r\nafterEach(async () => {\r\n  try {\r\n    if (mongoose.connection.readyState !== 0) {\r\n      const collections = await mongoose.connection.db.collections();\r\n      await Promise.all(collections.map(collection => collection.deleteMany({})));\r\n      console.log('Cleared all collections');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error clearing collections:', error);\r\n    throw error;\r\n  }\r\n});\r\n\r\n// Close database connection after all tests\r\nafterAll(async () => {\r\n  try {\r\n    if (mongoose.connection.readyState !== 0) {\r\n      await mongoose.connection.close();\r\n      console.log('Closed MongoDB connection');\r\n    }\r\n    if (mongod) {\r\n      await mongod.stop();\r\n      console.log('Stopped MongoDB Memory Server');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error closing MongoDB connection:', error);\r\n    throw error;\r\n  }\r\n}); "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AACpC,MAAM;EAAEC;AAAkB,CAAC,GAAGD,OAAO,CAAC,uBAAuB,CAAC;AAE9D,IAAIE,MAAM,GAAG,IAAI;;AAEjB;AACAC,SAAS,CAAC,YAAY;EACpB,IAAI;IACFC,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC;IAChDH,MAAM,GAAG,MAAMD,iBAAiB,CAACK,MAAM,CAAC;MACtCC,QAAQ,EAAE;QACRC,MAAM,EAAE,MAAM;QACdC,IAAI,EAAE;MACR,CAAC;MACDC,MAAM,EAAE;QACNC,OAAO,EAAE;MACX;IACF,CAAC,CAAC;IACF,MAAMC,GAAG,GAAGV,MAAM,CAACW,MAAM,CAAC,CAAC;IAC3BT,OAAO,CAACC,GAAG,CAAC,yCAAyC,EAAEO,GAAG,CAAC;IAE3D,MAAMb,QAAQ,CAACe,OAAO,CAACF,GAAG,EAAE;MAC1BG,wBAAwB,EAAE,KAAK;MAC/BC,eAAe,EAAE,KAAK;MACtBC,gBAAgB,EAAE;IACpB,CAAC,CAAC;IACFb,OAAO,CAACC,GAAG,CAAC,iDAAiD,CAAC;EAChE,CAAC,CAAC,OAAOa,KAAK,EAAE;IACdd,OAAO,CAACc,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;IAC/D,MAAMA,KAAK;EACb;AACF,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC;;AAEX;AACAC,SAAS,CAAC,YAAY;EACpB,IAAI;IACF,IAAIpB,QAAQ,CAACqB,UAAU,CAACC,UAAU,KAAK,CAAC,EAAE;MACxC,MAAMC,WAAW,GAAG,MAAMvB,QAAQ,CAACqB,UAAU,CAACG,EAAE,CAACD,WAAW,CAAC,CAAC;MAC9D,MAAME,OAAO,CAACC,GAAG,CAACH,WAAW,CAACI,GAAG,CAACC,UAAU,IAAIA,UAAU,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAC3ExB,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC;IACxC;EACF,CAAC,CAAC,OAAOa,KAAK,EAAE;IACdd,OAAO,CAACc,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;IACnD,MAAMA,KAAK;EACb;AACF,CAAC,CAAC;;AAEF;AACAW,QAAQ,CAAC,YAAY;EACnB,IAAI;IACF,IAAI9B,QAAQ,CAACqB,UAAU,CAACC,UAAU,KAAK,CAAC,EAAE;MACxC,MAAMtB,QAAQ,CAACqB,UAAU,CAACU,KAAK,CAAC,CAAC;MACjC1B,OAAO,CAACC,GAAG,CAAC,2BAA2B,CAAC;IAC1C;IACA,IAAIH,MAAM,EAAE;MACV,MAAMA,MAAM,CAAC6B,IAAI,CAAC,CAAC;MACnB3B,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;IAC9C;EACF,CAAC,CAAC,OAAOa,KAAK,EAAE;IACdd,OAAO,CAACc,KAAK,CAAC,mCAAmC,EAAEA,KAAK,CAAC;IACzD,MAAMA,KAAK;EACb;AACF,CAAC,CAAC","ignoreList":[]}