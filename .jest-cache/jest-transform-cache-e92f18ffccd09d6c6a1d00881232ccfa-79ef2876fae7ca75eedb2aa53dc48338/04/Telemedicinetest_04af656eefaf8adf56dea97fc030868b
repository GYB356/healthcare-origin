aaeae1e08fd124f0c88460c6a9f25e74
"use strict";

// Mock the modules
_getJestObj().mock('axios');
_getJestObj().mock('../../context/SocketContext', () => _objectSpread(_objectSpread({}, jest.requireActual('../../context/SocketContext')), {}, {
  useSocket: () => ({
    socket: {
      on: jest.fn(),
      off: jest.fn(),
      emit: jest.fn()
    },
    joinTelemedicineSession: jest.fn(),
    leaveTelemedicineSession: jest.fn()
  })
}));

// Mock getUserMedia
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _react = _interopRequireDefault(require("react"));
var _react2 = require("@testing-library/react");
var _reactRouterDom = require("react-router-dom");
var _AuthContext = require("../../context/AuthContext");
var _SocketContext = require("../../context/SocketContext");
var _Telemedicine = _interopRequireDefault(require("../../pages/Telemedicine"));
var _axios = _interopRequireDefault(require("axios"));
var _jsxRuntime = require("react/jsx-runtime");
var _jsxFileName = "C:\\Users\\olari\\Downloads\\healthcare-main\\healthcare-main\\HealthcareSync\\frontend\\src\\components\\__tests__\\Telemedicine.test.js";
import React from "react";
var __jsx = React.createElement;
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
const mockGetUserMedia = jest.fn(async () => ({
  getTracks: () => [{
    enabled: true,
    stop: jest.fn()
  }]
}));
Object.defineProperty(global.navigator, 'mediaDevices', {
  value: {
    getUserMedia: mockGetUserMedia
  }
});

// Mock RTCPeerConnection
global.RTCPeerConnection = jest.fn().mockImplementation(() => ({
  addTrack: jest.fn(),
  createOffer: jest.fn().mockResolvedValue({
    sdp: 'test-sdp'
  }),
  setLocalDescription: jest.fn(),
  setRemoteDescription: jest.fn(),
  addIceCandidate: jest.fn(),
  close: jest.fn(),
  ontrack: null,
  onicecandidate: null
}));
describe('Telemedicine Component', () => {
  const mockSession = {
    id: 'test-session',
    doctorId: 'doctor-1',
    patientId: 'patient-1',
    scheduledTime: new Date().toISOString(),
    status: 'scheduled'
  };
  const renderComponent = (role = 'doctor') => {
    const mockUser = {
      id: 'user-1',
      role: role
    };
    return (0, _react2.render)(/*#__PURE__*/(0, _jsxRuntime.jsx)(_reactRouterDom.MemoryRouter, {
      initialEntries: ['/telemedicine/test-session'],
      children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_AuthContext.AuthProvider, {
        value: {
          user: mockUser,
          hasRole: () => true
        },
        children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_SocketContext.SocketProvider, {
          children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_reactRouterDom.Routes, {
            children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_reactRouterDom.Route, {
              path: "/telemedicine/:sessionId",
              element: /*#__PURE__*/(0, _jsxRuntime.jsx)(_Telemedicine.default, {})
            })
          })
        })
      })
    }));
  };
  beforeEach(() => {
    jest.clearAllMocks();
    _axios.default.get.mockResolvedValue({
      data: mockSession
    });
  });
  it('renders access denied for unauthorized users', () => {
    const mockUser = {
      id: 'user-1',
      role: 'staff'
    };
    (0, _react2.render)(/*#__PURE__*/(0, _jsxRuntime.jsx)(_reactRouterDom.MemoryRouter, {
      children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_AuthContext.AuthProvider, {
        value: {
          user: mockUser,
          hasRole: () => false
        },
        children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_SocketContext.SocketProvider, {
          children: /*#__PURE__*/(0, _jsxRuntime.jsx)(_Telemedicine.default, {})
        })
      })
    }));
    expect(_react2.screen.getByText('Access Denied')).toBeInTheDocument();
  });
  it('loads and displays telemedicine session', async () => {
    renderComponent();
    await (0, _react2.waitFor)(() => {
      expect(_axios.default.get).toHaveBeenCalledWith('/api/telemedicine/sessions/test-session');
    });
    expect(_react2.screen.getByText(/Telemedicine Session/)).toBeInTheDocument();
  });
  it('handles media stream initialization', async () => {
    renderComponent();
    const startCallButton = await _react2.screen.findByText('Start Call');
    _react2.fireEvent.click(startCallButton);
    await (0, _react2.waitFor)(() => {
      expect(mockGetUserMedia).toHaveBeenCalledWith({
        video: true,
        audio: true
      });
    });
  });
  it('toggles audio and video', async () => {
    renderComponent();

    // Start the call
    const startCallButton = await _react2.screen.findByText('Start Call');
    _react2.fireEvent.click(startCallButton);
    await (0, _react2.waitFor)(() => {
      expect(mockGetUserMedia).toHaveBeenCalled();
    });

    // Toggle audio
    const audioButton = _react2.screen.getByRole('button', {
      name: /audio/i
    });
    _react2.fireEvent.click(audioButton);

    // Toggle video
    const videoButton = _react2.screen.getByRole('button', {
      name: /video/i
    });
    _react2.fireEvent.click(videoButton);
  });
  it('handles error states', async () => {
    _axios.default.get.mockRejectedValueOnce(new Error('Failed to load session'));
    renderComponent();
    await (0, _react2.waitFor)(() => {
      expect(_react2.screen.getByText('Error')).toBeInTheDocument();
      expect(_react2.screen.getByText('Failed to load session')).toBeInTheDocument();
    });
  });
  it('cleans up resources on unmount', async () => {
    const {
      unmount
    } = renderComponent();

    // Start the call
    const startCallButton = await _react2.screen.findByText('Start Call');
    _react2.fireEvent.click(startCallButton);
    await (0, _react2.waitFor)(() => {
      expect(mockGetUserMedia).toHaveBeenCalled();
    });
    unmount();

    // Verify cleanup
    expect(mockGetUserMedia().getTracks()[0].stop).toHaveBeenCalled();
  });
  it('renders the Telemedicine page', () => {
    (0, _react2.render)(/*#__PURE__*/(0, _jsxRuntime.jsx)(_Telemedicine.default, {}));
    expect(_react2.screen.getByText('Telemedicine')).toBeInTheDocument();
    expect(_react2.screen.getByText('Welcome to the Telemedicine page.')).toBeInTheDocument();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfb2JqZWN0U3ByZWFkIiwiamVzdCIsInJlcXVpcmVBY3R1YWwiLCJ1c2VTb2NrZXQiLCJzb2NrZXQiLCJvbiIsImZuIiwib2ZmIiwiZW1pdCIsImpvaW5UZWxlbWVkaWNpbmVTZXNzaW9uIiwibGVhdmVUZWxlbWVkaWNpbmVTZXNzaW9uIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZGVmaW5lUHJvcGVydHkyIiwiX3JlYWN0IiwiX3JlYWN0MiIsIl9yZWFjdFJvdXRlckRvbSIsIl9BdXRoQ29udGV4dCIsIl9Tb2NrZXRDb250ZXh0IiwiX1RlbGVtZWRpY2luZSIsIl9heGlvcyIsIl9qc3hSdW50aW1lIiwiX2pzeEZpbGVOYW1lIiwiUmVhY3QiLCJfX2pzeCIsImNyZWF0ZUVsZW1lbnQiLCJvd25LZXlzIiwiZSIsInIiLCJ0IiwiT2JqZWN0Iiwia2V5cyIsImdldE93blByb3BlcnR5U3ltYm9scyIsIm8iLCJmaWx0ZXIiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsImRlZmF1bHQiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsImRlZmluZVByb3BlcnR5IiwibW9ja0dldFVzZXJNZWRpYSIsImdldFRyYWNrcyIsImVuYWJsZWQiLCJzdG9wIiwiZ2xvYmFsIiwibmF2aWdhdG9yIiwidmFsdWUiLCJnZXRVc2VyTWVkaWEiLCJSVENQZWVyQ29ubmVjdGlvbiIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsImFkZFRyYWNrIiwiY3JlYXRlT2ZmZXIiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInNkcCIsInNldExvY2FsRGVzY3JpcHRpb24iLCJzZXRSZW1vdGVEZXNjcmlwdGlvbiIsImFkZEljZUNhbmRpZGF0ZSIsImNsb3NlIiwib250cmFjayIsIm9uaWNlY2FuZGlkYXRlIiwiZGVzY3JpYmUiLCJtb2NrU2Vzc2lvbiIsImlkIiwiZG9jdG9ySWQiLCJwYXRpZW50SWQiLCJzY2hlZHVsZWRUaW1lIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic3RhdHVzIiwicmVuZGVyQ29tcG9uZW50Iiwicm9sZSIsIm1vY2tVc2VyIiwicmVuZGVyIiwianN4IiwiTWVtb3J5Um91dGVyIiwiaW5pdGlhbEVudHJpZXMiLCJjaGlsZHJlbiIsIkF1dGhQcm92aWRlciIsInVzZXIiLCJoYXNSb2xlIiwiU29ja2V0UHJvdmlkZXIiLCJSb3V0ZXMiLCJSb3V0ZSIsInBhdGgiLCJlbGVtZW50IiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJheGlvcyIsImdldCIsImRhdGEiLCJpdCIsImV4cGVjdCIsInNjcmVlbiIsImdldEJ5VGV4dCIsInRvQmVJblRoZURvY3VtZW50Iiwid2FpdEZvciIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwic3RhcnRDYWxsQnV0dG9uIiwiZmluZEJ5VGV4dCIsImZpcmVFdmVudCIsImNsaWNrIiwidmlkZW8iLCJhdWRpbyIsInRvSGF2ZUJlZW5DYWxsZWQiLCJhdWRpb0J1dHRvbiIsImdldEJ5Um9sZSIsIm5hbWUiLCJ2aWRlb0J1dHRvbiIsIm1vY2tSZWplY3RlZFZhbHVlT25jZSIsIkVycm9yIiwidW5tb3VudCJdLCJzb3VyY2VzIjpbIlRlbGVtZWRpY2luZS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50LCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgeyBNZW1vcnlSb3V0ZXIsIFJvdXRlLCBSb3V0ZXMgfSBmcm9tICdyZWFjdC1yb3V0ZXItZG9tJztcbmltcG9ydCB7IEF1dGhQcm92aWRlciB9IGZyb20gJy4uLy4uL2NvbnRleHQvQXV0aENvbnRleHQnO1xuaW1wb3J0IHsgU29ja2V0UHJvdmlkZXIgfSBmcm9tICcuLi8uLi9jb250ZXh0L1NvY2tldENvbnRleHQnO1xuaW1wb3J0IFRlbGVtZWRpY2luZSBmcm9tICcuLi8uLi9wYWdlcy9UZWxlbWVkaWNpbmUnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuLy8gTW9jayB0aGUgbW9kdWxlc1xuamVzdC5tb2NrKCdheGlvcycpO1xuamVzdC5tb2NrKCcuLi8uLi9jb250ZXh0L1NvY2tldENvbnRleHQnLCAoKSA9PiAoe1xuICAuLi5qZXN0LnJlcXVpcmVBY3R1YWwoJy4uLy4uL2NvbnRleHQvU29ja2V0Q29udGV4dCcpLFxuICB1c2VTb2NrZXQ6ICgpID0+ICh7XG4gICAgc29ja2V0OiB7XG4gICAgICBvbjogamVzdC5mbigpLFxuICAgICAgb2ZmOiBqZXN0LmZuKCksXG4gICAgICBlbWl0OiBqZXN0LmZuKClcbiAgICB9LFxuICAgIGpvaW5UZWxlbWVkaWNpbmVTZXNzaW9uOiBqZXN0LmZuKCksXG4gICAgbGVhdmVUZWxlbWVkaWNpbmVTZXNzaW9uOiBqZXN0LmZuKClcbiAgfSlcbn0pKTtcblxuLy8gTW9jayBnZXRVc2VyTWVkaWFcbmNvbnN0IG1vY2tHZXRVc2VyTWVkaWEgPSBqZXN0LmZuKGFzeW5jICgpID0+ICh7XG4gIGdldFRyYWNrczogKCkgPT4gW3tcbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIHN0b3A6IGplc3QuZm4oKVxuICB9XVxufSkpO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZ2xvYmFsLm5hdmlnYXRvciwgJ21lZGlhRGV2aWNlcycsIHtcbiAgdmFsdWU6IHtcbiAgICBnZXRVc2VyTWVkaWE6IG1vY2tHZXRVc2VyTWVkaWFcbiAgfVxufSk7XG5cbi8vIE1vY2sgUlRDUGVlckNvbm5lY3Rpb25cbmdsb2JhbC5SVENQZWVyQ29ubmVjdGlvbiA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgYWRkVHJhY2s6IGplc3QuZm4oKSxcbiAgY3JlYXRlT2ZmZXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHNkcDogJ3Rlc3Qtc2RwJyB9KSxcbiAgc2V0TG9jYWxEZXNjcmlwdGlvbjogamVzdC5mbigpLFxuICBzZXRSZW1vdGVEZXNjcmlwdGlvbjogamVzdC5mbigpLFxuICBhZGRJY2VDYW5kaWRhdGU6IGplc3QuZm4oKSxcbiAgY2xvc2U6IGplc3QuZm4oKSxcbiAgb250cmFjazogbnVsbCxcbiAgb25pY2VjYW5kaWRhdGU6IG51bGxcbn0pKTtcblxuZGVzY3JpYmUoJ1RlbGVtZWRpY2luZSBDb21wb25lbnQnLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tTZXNzaW9uID0ge1xuICAgIGlkOiAndGVzdC1zZXNzaW9uJyxcbiAgICBkb2N0b3JJZDogJ2RvY3Rvci0xJyxcbiAgICBwYXRpZW50SWQ6ICdwYXRpZW50LTEnLFxuICAgIHNjaGVkdWxlZFRpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICBzdGF0dXM6ICdzY2hlZHVsZWQnXG4gIH07XG5cbiAgY29uc3QgcmVuZGVyQ29tcG9uZW50ID0gKHJvbGUgPSAnZG9jdG9yJykgPT4ge1xuICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgaWQ6ICd1c2VyLTEnLFxuICAgICAgcm9sZTogcm9sZVxuICAgIH07XG5cbiAgICByZXR1cm4gcmVuZGVyKFxuICAgICAgPE1lbW9yeVJvdXRlciBpbml0aWFsRW50cmllcz17WycvdGVsZW1lZGljaW5lL3Rlc3Qtc2Vzc2lvbiddfT5cbiAgICAgICAgPEF1dGhQcm92aWRlciB2YWx1ZT17eyB1c2VyOiBtb2NrVXNlciwgaGFzUm9sZTogKCkgPT4gdHJ1ZSB9fT5cbiAgICAgICAgICA8U29ja2V0UHJvdmlkZXI+XG4gICAgICAgICAgICA8Um91dGVzPlxuICAgICAgICAgICAgICA8Um91dGUgcGF0aD1cIi90ZWxlbWVkaWNpbmUvOnNlc3Npb25JZFwiIGVsZW1lbnQ9ezxUZWxlbWVkaWNpbmUgLz59IC8+XG4gICAgICAgICAgICA8L1JvdXRlcz5cbiAgICAgICAgICA8L1NvY2tldFByb3ZpZGVyPlxuICAgICAgICA8L0F1dGhQcm92aWRlcj5cbiAgICAgIDwvTWVtb3J5Um91dGVyPlxuICAgICk7XG4gIH07XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgYXhpb3MuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogbW9ja1Nlc3Npb24gfSk7XG4gIH0pO1xuXG4gIGl0KCdyZW5kZXJzIGFjY2VzcyBkZW5pZWQgZm9yIHVuYXV0aG9yaXplZCB1c2VycycsICgpID0+IHtcbiAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgIGlkOiAndXNlci0xJyxcbiAgICAgIHJvbGU6ICdzdGFmZidcbiAgICB9O1xuXG4gICAgcmVuZGVyKFxuICAgICAgPE1lbW9yeVJvdXRlcj5cbiAgICAgICAgPEF1dGhQcm92aWRlciB2YWx1ZT17eyB1c2VyOiBtb2NrVXNlciwgaGFzUm9sZTogKCkgPT4gZmFsc2UgfX0+XG4gICAgICAgICAgPFNvY2tldFByb3ZpZGVyPlxuICAgICAgICAgICAgPFRlbGVtZWRpY2luZSAvPlxuICAgICAgICAgIDwvU29ja2V0UHJvdmlkZXI+XG4gICAgICAgIDwvQXV0aFByb3ZpZGVyPlxuICAgICAgPC9NZW1vcnlSb3V0ZXI+XG4gICAgKTtcblxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdBY2Nlc3MgRGVuaWVkJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gIH0pO1xuXG4gIGl0KCdsb2FkcyBhbmQgZGlzcGxheXMgdGVsZW1lZGljaW5lIHNlc3Npb24nLCBhc3luYyAoKSA9PiB7XG4gICAgcmVuZGVyQ29tcG9uZW50KCk7XG5cbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgIGV4cGVjdChheGlvcy5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvYXBpL3RlbGVtZWRpY2luZS9zZXNzaW9ucy90ZXN0LXNlc3Npb24nKTtcbiAgICB9KTtcblxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KC9UZWxlbWVkaWNpbmUgU2Vzc2lvbi8pKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICB9KTtcblxuICBpdCgnaGFuZGxlcyBtZWRpYSBzdHJlYW0gaW5pdGlhbGl6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgcmVuZGVyQ29tcG9uZW50KCk7XG5cbiAgICBjb25zdCBzdGFydENhbGxCdXR0b24gPSBhd2FpdCBzY3JlZW4uZmluZEJ5VGV4dCgnU3RhcnQgQ2FsbCcpO1xuICAgIGZpcmVFdmVudC5jbGljayhzdGFydENhbGxCdXR0b24pO1xuXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBleHBlY3QobW9ja0dldFVzZXJNZWRpYSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB2aWRlbzogdHJ1ZSxcbiAgICAgICAgYXVkaW86IHRydWVcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgndG9nZ2xlcyBhdWRpbyBhbmQgdmlkZW8nLCBhc3luYyAoKSA9PiB7XG4gICAgcmVuZGVyQ29tcG9uZW50KCk7XG5cbiAgICAvLyBTdGFydCB0aGUgY2FsbFxuICAgIGNvbnN0IHN0YXJ0Q2FsbEJ1dHRvbiA9IGF3YWl0IHNjcmVlbi5maW5kQnlUZXh0KCdTdGFydCBDYWxsJyk7XG4gICAgZmlyZUV2ZW50LmNsaWNrKHN0YXJ0Q2FsbEJ1dHRvbik7XG5cbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgIGV4cGVjdChtb2NrR2V0VXNlck1lZGlhKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICAvLyBUb2dnbGUgYXVkaW9cbiAgICBjb25zdCBhdWRpb0J1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2F1ZGlvL2kgfSk7XG4gICAgZmlyZUV2ZW50LmNsaWNrKGF1ZGlvQnV0dG9uKTtcblxuICAgIC8vIFRvZ2dsZSB2aWRlb1xuICAgIGNvbnN0IHZpZGVvQnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvdmlkZW8vaSB9KTtcbiAgICBmaXJlRXZlbnQuY2xpY2sodmlkZW9CdXR0b24pO1xuICB9KTtcblxuICBpdCgnaGFuZGxlcyBlcnJvciBzdGF0ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgYXhpb3MuZ2V0Lm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ0ZhaWxlZCB0byBsb2FkIHNlc3Npb24nKSk7XG4gICAgcmVuZGVyQ29tcG9uZW50KCk7XG5cbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdFcnJvcicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ0ZhaWxlZCB0byBsb2FkIHNlc3Npb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ2NsZWFucyB1cCByZXNvdXJjZXMgb24gdW5tb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IHVubW91bnQgfSA9IHJlbmRlckNvbXBvbmVudCgpO1xuXG4gICAgLy8gU3RhcnQgdGhlIGNhbGxcbiAgICBjb25zdCBzdGFydENhbGxCdXR0b24gPSBhd2FpdCBzY3JlZW4uZmluZEJ5VGV4dCgnU3RhcnQgQ2FsbCcpO1xuICAgIGZpcmVFdmVudC5jbGljayhzdGFydENhbGxCdXR0b24pO1xuXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBleHBlY3QobW9ja0dldFVzZXJNZWRpYSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgdW5tb3VudCgpO1xuXG4gICAgLy8gVmVyaWZ5IGNsZWFudXBcbiAgICBleHBlY3QobW9ja0dldFVzZXJNZWRpYSgpLmdldFRyYWNrcygpWzBdLnN0b3ApLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ3JlbmRlcnMgdGhlIFRlbGVtZWRpY2luZSBwYWdlJywgKCkgPT4ge1xuICAgIHJlbmRlcig8VGVsZW1lZGljaW5lIC8+KTtcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnVGVsZW1lZGljaW5lJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ1dlbGNvbWUgdG8gdGhlIFRlbGVtZWRpY2luZSBwYWdlLicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICB9KTtcbn0pOyAiXSwibWFwcGluZ3MiOiI7O0FBUUE7QUFDQUEsV0FBQSxHQUFLQyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQ2xCRCxXQUFBLEdBQUtDLElBQUksQ0FBQyw2QkFBNkIsRUFBRSxNQUFBQyxhQUFBLENBQUFBLGFBQUEsS0FDcENDLElBQUksQ0FBQ0MsYUFBYSxDQUFDLDZCQUE2QixDQUFDO0VBQ3BEQyxTQUFTLEVBQUVBLENBQUEsTUFBTztJQUNoQkMsTUFBTSxFQUFFO01BQ05DLEVBQUUsRUFBRUosSUFBSSxDQUFDSyxFQUFFLENBQUMsQ0FBQztNQUNiQyxHQUFHLEVBQUVOLElBQUksQ0FBQ0ssRUFBRSxDQUFDLENBQUM7TUFDZEUsSUFBSSxFQUFFUCxJQUFJLENBQUNLLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBQ0RHLHVCQUF1QixFQUFFUixJQUFJLENBQUNLLEVBQUUsQ0FBQyxDQUFDO0lBQ2xDSSx3QkFBd0IsRUFBRVQsSUFBSSxDQUFDSyxFQUFFLENBQUM7RUFDcEMsQ0FBQztBQUFDLEVBQ0YsQ0FBQzs7QUFFSDtBQUFBLElBQUFLLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBQyxnQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBdkJBLElBQUFFLE1BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLE9BQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLGVBQUEsR0FBQUosT0FBQTtBQUNBLElBQUFLLFlBQUEsR0FBQUwsT0FBQTtBQUNBLElBQUFNLGNBQUEsR0FBQU4sT0FBQTtBQUNBLElBQUFPLGFBQUEsR0FBQVIsc0JBQUEsQ0FBQUMs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