(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[883],{1639:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return C}});var r=s(29),n=s(4687),a=s.n(n),i=s(7294),l=s(3299),o=s(2947),c=s(3907),d=s(6993),u=s(1029),m=s(9897),p=s(5893);function x(e){var t,s=e.onEventClick,n=e.onSelectSlot,x=e.doctorId,b=e.patientId;(0,l.useSession)().data;var v=(0,i.useState)([]),g=v[0],j=v[1],y=(0,i.useState)(!0),w=(y[0],y[1]);(0,i.useEffect)(function(){N()},[x,b]);var N=(t=(0,r.Z)(a().mark(function e(){var t,s,r;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="/api/appointments",s=new URLSearchParams,x&&s.append("doctorId",x),b&&s.append("patientId",b),s.toString()&&(t+="?".concat(s.toString())),e.next=8,fetch(t);case 8:if((r=e.sent).ok){e.next=11;break}throw Error("Failed to fetch appointments");case 11:return e.next=13,r.json();case 13:j(e.sent),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Error fetching appointments:",e.t0),o.Am.error("Failed to load appointments");case 21:return e.prev=21,w(!1),e.finish(21);case 24:case"end":return e.stop()}},e,null,[[0,17,21,24]])})),function(){return t.apply(this,arguments)}),k=g.map(function(e){return{id:e.id,title:e.title,start:new Date("".concat(e.date,"T").concat(e.startTime)),end:new Date("".concat(e.date,"T").concat(e.endTime)),backgroundColor:f(e.status),borderColor:f(e.status),extendedProps:{isVirtual:e.isVirtual,status:e.status,patient:e.patient,doctor:e.doctor}}});return(0,p.jsx)("div",{className:"h-full bg-white rounded-lg shadow p-4",children:(0,p.jsx)(c.Z,{plugins:[d.Z,u.Z,m.ZP],initialView:"timeGridWeek",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:k,eventClick:function(e){var t=g.find(function(t){return t.id===e.event.id});t&&s&&s(t)},select:function(e){n&&n(e.start,e.end)},selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,allDaySlot:!1,slotMinTime:"08:00:00",slotMaxTime:"20:00:00",height:"auto",expandRows:!0,stickyHeaderDates:!0,nowIndicator:!0,eventContent:h,loading:function(e){return w(e)}})})}function h(e){var t=e.event.extendedProps,s=t.isVirtual,r=t.patient,n=t.doctor;return(0,p.jsxs)("div",{className:"p-1 overflow-hidden",children:[(0,p.jsx)("div",{className:"font-semibold text-sm truncate",children:e.event.title}),(0,p.jsxs)("div",{className:"text-xs truncate",children:[s&&"\uD83C\uDFA5 ",null==r?void 0:r.name," with Dr. ",null==n?void 0:n.name]})]})}function f(e){switch(e.toUpperCase()){case"SCHEDULED":return"#3B82F6";case"COMPLETED":return"#10B981";case"CANCELLED":return"#EF4444";case"RESCHEDULED":return"#F59E0B";default:return"#6B7280"}}var b=s(3298),v=s(8876),g=s(1415),j=s(8307),y=s(7536),w=s(5263);function N(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function k(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?N(Object(s),!0).forEach(function(t){(0,j.Z)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):N(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function T(e){var t,s,n=e.appointment,l=e.onSubmit,c=e.onCancel,d=(0,i.useState)([]),u=d[0],m=d[1],x=(0,i.useState)([]),h=x[0],f=x[1],b=(0,i.useState)(!1),v=b[0],g=b[1],j=(0,y.cI)({defaultValues:n||{title:"",notes:"",date:(0,w.WU)(new Date,"yyyy-MM-dd"),startTime:"09:00",endTime:"10:00",isVirtual:!1,status:"SCHEDULED"}}),N=j.register,T=j.handleSubmit,S=j.watch,E=j.formState.errors;j.setValue;var C=S("isVirtual");(0,i.useEffect)(function(){D()},[]);var D=(t=(0,r.Z)(a().mark(function e(){var t,s;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/users?role=DOCTOR");case 3:if((t=e.sent).ok){e.next=6;break}throw Error("Failed to fetch doctors");case 6:return e.next=8,t.json();case 8:return m(e.sent),e.next=12,fetch("/api/users?role=PATIENT");case 12:if((s=e.sent).ok){e.next=15;break}throw Error("Failed to fetch patients");case 15:return e.next=17,s.json();case 17:f(e.sent),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("Error fetching users:",e.t0),o.Am.error("Failed to load users");case 25:case"end":return e.stop()}},e,null,[[0,21]])})),function(){return t.apply(this,arguments)}),O=(s=(0,r.Z)(a().mark(function e(t){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,g(!0),e.next=4,l(t);case 4:o.Am.success("Appointment saved successfully"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error saving appointment:",e.t0),o.Am.error("Failed to save appointment");case 11:return e.prev=11,g(!1),e.finish(11);case 14:case"end":return e.stop()}},e,null,[[0,7,11,14]])})),function(e){return s.apply(this,arguments)});return(0,p.jsxs)("form",{onSubmit:T(O),className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Title"}),(0,p.jsx)("input",k(k({type:"text",id:"title"},N("title",{required:"Title is required"})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})),E.title&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.title.message})]}),(0,p.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700",children:"Date"}),(0,p.jsx)("input",k(k({type:"date",id:"date"},N("date",{required:"Date is required"})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})),E.date&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.date.message})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,p.jsxs)("select",k(k({id:"status"},N("status")),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[(0,p.jsx)("option",{value:"SCHEDULED",children:"Scheduled"}),(0,p.jsx)("option",{value:"COMPLETED",children:"Completed"}),(0,p.jsx)("option",{value:"CANCELLED",children:"Cancelled"}),(0,p.jsx)("option",{value:"RESCHEDULED",children:"Rescheduled"})]}))]})]}),(0,p.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"startTime",className:"block text-sm font-medium text-gray-700",children:"Start Time"}),(0,p.jsx)("input",k(k({type:"time",id:"startTime"},N("startTime",{required:"Start time is required"})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})),E.startTime&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.startTime.message})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"endTime",className:"block text-sm font-medium text-gray-700",children:"End Time"}),(0,p.jsx)("input",k(k({type:"time",id:"endTime"},N("endTime",{required:"End time is required"})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})),E.endTime&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.endTime.message})]})]}),(0,p.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"doctorId",className:"block text-sm font-medium text-gray-700",children:"Doctor"}),(0,p.jsxs)("select",k(k({id:"doctorId"},N("doctorId",{required:"Doctor is required"})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[(0,p.jsx)("option",{value:"",children:"Select a doctor"}),u.map(function(e){return(0,p.jsxs)("option",{value:e.id,children:["Dr. ",e.name]},e.id)})]})),E.doctorId&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.doctorId.message})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"patientId",className:"block text-sm font-medium text-gray-700",children:"Patient"}),(0,p.jsxs)("select",k(k({id:"patientId"},N("patientId",{required:"Patient is required"})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[(0,p.jsx)("option",{value:"",children:"Select a patient"}),h.map(function(e){return(0,p.jsx)("option",{value:e.id,children:e.name},e.id)})]})),E.patientId&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.patientId.message})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("input",k(k({type:"checkbox",id:"isVirtual"},N("isVirtual")),{},{className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"})),(0,p.jsx)("label",{htmlFor:"isVirtual",className:"ml-2 block text-sm text-gray-700",children:"Virtual Appointment"})]}),C&&(0,p.jsxs)("div",{className:"mt-4",children:[(0,p.jsx)("label",{htmlFor:"virtualLink",className:"block text-sm font-medium text-gray-700",children:"Virtual Meeting Link"}),(0,p.jsx)("input",k(k({type:"url",id:"virtualLink"},N("virtualLink",{required:!!C&&"Virtual meeting link is required",pattern:{value:/^https?:\/\/.+/i,message:"Please enter a valid URL"}})),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"https://meet.example.com/room"})),E.virtualLink&&(0,p.jsx)("p",{className:"mt-1 text-sm text-red-600",children:E.virtualLink.message})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,p.jsx)("textarea",k(k({id:"notes",rows:3},N("notes")),{},{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}))]}),(0,p.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,p.jsx)("button",{type:"button",onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,p.jsx)("button",{type:"submit",disabled:v,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:v?"Saving...":"Save"})]})]})}function S(e){var t=e.isOpen,s=e.onClose,r=e.appointment,n=e.onSubmit,a=e.title;return(0,p.jsx)(b.u.Root,{show:t,as:i.Fragment,children:(0,p.jsxs)(v.Vq,{as:"div",className:"relative z-50",onClose:s,children:[(0,p.jsx)(b.u.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,p.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})}),(0,p.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,p.jsx)("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:(0,p.jsx)(b.u.Child,{as:i.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,p.jsxs)(v.Vq.Panel,{className:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:p-6",children:[(0,p.jsx)("div",{className:"absolute right-0 top-0 hidden pr-4 pt-4 sm:block",children:(0,p.jsxs)("button",{type:"button",className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:s,children:[(0,p.jsx)("span",{className:"sr-only",children:"Close"}),(0,p.jsx)(g.Z,{className:"h-6 w-6","aria-hidden":"true"})]})}),(0,p.jsx)("div",{className:"sm:flex sm:items-start",children:(0,p.jsxs)("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full",children:[(0,p.jsx)(v.Vq.Title,{as:"h3",className:"text-base font-semibold leading-6 text-gray-900 mb-6",children:a}),(0,p.jsx)("div",{className:"mt-2",children:(0,p.jsx)(T,{appointment:r,onSubmit:n,onCancel:s})})]})})]})})})})]})})}var E=s(385);function C(){var e,t,s,n,c=(0,l.useSession)().data,d=(0,i.useState)(!1),u=d[0],m=d[1],h=(0,i.useState)(null),f=h[0],b=h[1],v=(0,i.useState)(null),g=v[0],j=v[1],y=(e=(0,r.Z)(a().mark(function e(t){var s,r,n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=f?"/api/appointments/".concat(f.id):"/api/appointments",r=f?"PUT":"POST",e.next=5,fetch(s,{method:r,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 5:if((n=e.sent).ok){e.next=11;break}return e.next=9,n.json();case 9:throw Error(e.sent.error||"Failed to save appointment");case 11:m(!1),b(null),j(null),o.Am.success("Appointment ".concat(f?"updated":"created"," successfully")),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),o.Am.error(e.t0.message);case 20:case"end":return e.stop()}},e,null,[[0,17]])})),function(t){return e.apply(this,arguments)});return(0,p.jsx)("div",{className:"min-h-screen bg-gray-100 py-8",children:(0,p.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,p.jsxs)("div",{className:"md:flex md:items-center md:justify-between mb-8",children:[(0,p.jsx)("div",{className:"flex-1 min-w-0",children:(0,p.jsx)("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate",children:"Appointments"})}),(null==c||null===(t=c.user)||void 0===t?void 0:t.role)&&[E.UserRole.STAFF,E.UserRole.ADMIN,E.UserRole.DOCTOR].includes(c.user.role)&&(0,p.jsx)("div",{className:"mt-4 flex md:mt-0 md:ml-4",children:(0,p.jsx)("button",{type:"button",onClick:function(){b(null),j(null),m(!0)},className:"ml-3 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Create Appointment"})})]}),(0,p.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,p.jsx)(x,{onEventClick:function(e){b(e),m(!0)},onSelectSlot:function(e,t){var s;if(!(null!=c&&null!==(s=c.user)&&void 0!==s&&s.role)||![E.UserRole.STAFF,E.UserRole.ADMIN,E.UserRole.DOCTOR].includes(c.user.role)){o.Am.error("You do not have permission to create appointments");return}j({start:e,end:t}),b(null),m(!0)},doctorId:(null==c||null===(s=c.user)||void 0===s?void 0:s.role)===E.UserRole.DOCTOR?c.user.id:void 0,patientId:(null==c||null===(n=c.user)||void 0===n?void 0:n.role)===E.UserRole.PATIENT?c.user.id:void 0})}),(0,p.jsx)(S,{isOpen:u,onClose:function(){m(!1),b(null),j(null)},appointment:f||(g?{date:g.start.toISOString().split("T")[0],startTime:g.start.toTimeString().slice(0,5),endTime:g.end.toTimeString().slice(0,5),status:"SCHEDULED",isVirtual:!1}:null),onSubmit:y,title:f?"Edit Appointment":"Create Appointment"})]})})}},2962:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/appointments",function(){return s(1639)}])}},function(e){e.O(0,[69,195,152,888,774,179],function(){return e(e.s=2962)}),_N_E=e.O()}]);