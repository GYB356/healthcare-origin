(()=>{var e={};e.id=518,e.ids=[518,660],e.modules={829:(e,s,t)=>{"use strict";t.d(s,{Z:()=>o}),t(6689);var r=t(4279),a=t(997);let n=()=>{let{user:e}=(0,r.aC)(),s=(()=>{let s={admin:[{name:"Users",href:"/admin/users",icon:"\uD83D\uDC65"},{name:"Settings",href:"/admin/settings",icon:"⚙️"},{name:"Reports",href:"/admin/reports",icon:"\uD83D\uDCC8"}],doctor:[{name:"Patients",href:"/doctor/patients",icon:"\uD83C\uDFE5"},{name:"Appointments",href:"/doctor/appointments",icon:"\uD83D\uDCC5"},{name:"Prescriptions",href:"/doctor/prescriptions",icon:"\uD83D\uDC8A"}],patient:[{name:"Appointments",href:"/patient/appointments",icon:"\uD83D\uDCC5"},{name:"Medical Records",href:"/patient/records",icon:"\uD83D\uDCCB"},{name:"Messages",href:"/patient/messages",icon:"✉️"}],nurse:[{name:"Patients",href:"/nurse/patients",icon:"\uD83C\uDFE5"},{name:"Schedule",href:"/nurse/schedule",icon:"\uD83D\uDCC5"}],staff:[{name:"Appointments",href:"/staff/appointments",icon:"\uD83D\uDCC5"},{name:"Billing",href:"/staff/billing",icon:"\uD83D\uDCB0"}]};return[{name:"Dashboard",href:"/dashboard",icon:"\uD83D\uDCCA"},{name:"Profile",href:"/profile",icon:"\uD83D\uDC64"},...e?.role&&s[e.role]?s[e.role]:[]]})();return(0,a.jsxs)("aside",{className:"sidebar",children:[a.jsx("div",{className:"sidebar-header",children:a.jsx("h3",{children:e?.role?`${e.role.charAt(0).toUpperCase()+e.role.slice(1)} Portal`:"Portal"})}),a.jsx("nav",{className:"sidebar-nav",children:a.jsx("ul",{children:s.map(e=>a.jsx("li",{children:(0,a.jsxs)("a",{href:e.href,children:[a.jsx("span",{className:"icon",children:e.icon}),a.jsx("span",{className:"link-text",children:e.name})]})},e.name))})})]})},i=()=>{let{user:e,logout:s}=(0,r.aC)();return(0,a.jsxs)("nav",{className:"navigation",children:[a.jsx("div",{className:"logo",children:a.jsx("span",{children:"Healthcare Portal"})}),(0,a.jsxs)("div",{className:"nav-links",children:[a.jsx("a",{href:"/dashboard",children:"Dashboard"}),a.jsx("a",{href:"/appointments",children:"Appointments"}),a.jsx("a",{href:"/messages",children:"Messages"}),e?.role==="admin"&&a.jsx("a",{href:"/admin",children:"Admin"})]}),(0,a.jsxs)("div",{className:"user-menu",children:[a.jsx("span",{children:e?.username}),a.jsx("button",{onClick:s,children:"Logout"})]})]})},o=({children:e})=>{let{isAuthenticated:s}=(0,r.aC)();return a.jsx("div",{className:"layout",children:s?(0,a.jsxs)(a.Fragment,{children:[a.jsx(i,{}),(0,a.jsxs)("div",{className:"layout-container",children:[a.jsx(n,{}),a.jsx("main",{className:"main-content",children:e})]})]}):a.jsx("main",{className:"main-content-unauthenticated",children:e})})}},4250:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});var r=t(997);function a({size:e="md",className:s=""}){return r.jsx("div",{className:`${s} flex items-center justify-center`,children:(0,r.jsxs)("svg",{className:`${{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[e]} animate-spin text-blue-600`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}},2211:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(s,{Z:()=>c});var a=t(6689),n=t(1649),i=t(3590),o=t(997),l=e([i]);function c({onConversationCreated:e}){let{data:s}=(0,n.useSession)(),{0:t,1:r}=(0,a.useState)([]),{0:l,1:c}=(0,a.useState)(""),{0:d,1:u}=(0,a.useState)(!1);(0,a.useEffect)(()=>{h()},[s?.user?.role]);let h=async()=>{try{let e=s?.user?.role==="doctor"?"patients":"doctors",t=await fetch(`/api/users/${e}`),a=await t.json();r(a)}catch(e){console.error("Error fetching users:",e),i.toast.error("Failed to load users")}},m=async t=>{if(t.preventDefault(),l){u(!0);try{if(!(await fetch("/api/conversations/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctorId:s?.user?.role==="doctor"?s.user.id:l,patientId:s?.user?.role==="patient"?s.user.id:l})})).ok)throw Error("Failed to create conversation");i.toast.success("Conversation created successfully"),e(),c("")}catch(e){console.error("Error creating conversation:",e),i.toast.error("Failed to create conversation")}finally{u(!1)}}};return(0,o.jsxs)("form",{onSubmit:m,className:"p-4 bg-white rounded-lg shadow",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Start New Conversation"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{htmlFor:"user",className:"block text-sm font-medium text-gray-700",children:["Select ",s?.user?.role==="doctor"?"Patient":"Doctor"]}),(0,o.jsxs)("select",{id:"user",value:l,onChange:e=>c(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[(0,o.jsxs)("option",{value:"",children:["Select a ",s?.user?.role==="doctor"?"patient":"doctor"]}),t.map(e=>o.jsx("option",{value:e.id,children:e.name},e.id))]})]}),o.jsx("button",{type:"submit",disabled:d||!l,className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed",children:d?"Creating...":"Start Conversation"})]})]})}i=(l.then?(await l)():l)[0],r()}catch(e){r(e)}})},9884:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(s,{K0:()=>c});var a=t(6689),n=t(3590),i=t(997),o=e([n]);n=(o.then?(await o)():o)[0];let l={info:"bg-blue-100 border-blue-500 text-blue-800",success:"bg-green-100 border-green-500 text-green-800",error:"bg-red-100 border-red-500 text-red-800",warning:"bg-yellow-100 border-yellow-500 text-yellow-800"},c=e=>{let{message:s,type:t,duration:r,onClose:n}=e,{0:o,1:c}=(0,a.useState)(!0);return((0,a.useEffect)(()=>{if(r){let e=setTimeout(()=>{c(!1),n?.()},r);return()=>clearTimeout(e)}},[r,n]),o)?i.jsx("div",{className:`${l[t]} border-l-4 p-4 mb-4 rounded shadow-sm`,children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"flex items-center",children:i.jsx("span",{className:"font-medium",children:s})}),i.jsx("button",{onClick:()=>{c(!1),n?.()},className:"text-gray-500 hover:text-gray-800",children:"\xd7"})]})}):null};r()}catch(e){r(e)}})},2691:(e,s,t)=>{"use strict";t.d(s,{Z:()=>o});var r=t(1649),a=t(1163),n=t(6689),i=t(997);function o({children:e,allowedRoles:s}){let{data:t,status:o}=(0,r.useSession)(),l=(0,a.useRouter)();return((0,n.useEffect)(()=>{if("unauthenticated"===o){l.push("/auth/signin");return}t?.user&&s&&!s.includes(t.user.role)&&l.push("doctor"===t.user.role?"/doctor/dashboard":"/patient/dashboard")},[t,o,l,s]),"loading"===o)?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):t?.user&&(!s||s.includes(t.user.role))?i.jsx(i.Fragment,{children:e}):null}},1517:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.d(s,{Z:()=>x});var a=t(6689),n=t(1649),i=t(4612),o=t(3590);t(8819);var l=t(2211),c=t(4250),d=t(9884),u=t(5634),h=t(997),m=e([i,o,l,d]);function x(){let{data:e}=(0,n.useSession)(),{0:s,1:t}=(0,a.useState)([]),{0:r,1:m}=(0,a.useState)(null),{0:x,1:p}=(0,a.useState)(""),{0:g,1:f}=(0,a.useState)(0),b=(0,a.useRef)(null),j=(0,a.useRef)(null),{0:v,1:y}=(0,a.useState)(!0),{0:N,1:w}=(0,a.useState)(null);(0,a.useEffect)(()=>{if(e?.user?.id)return b.current=(0,i.io)(process.env.NEXTAUTH_URL||"http://localhost:3000"),b.current.on("new_message",s=>{t(e=>{let t=[...e],r=t.find(e=>e.id===s.conversationId);return r&&r.messages.push(s),t}),s.sender.id!==e.user.id&&o.toast.info(`New message from ${s.sender.name}`)}),b.current.on("message_read",e=>{t(s=>{let t=[...s];return t.forEach(s=>{s.messages.forEach(s=>{s.id===e&&(s.read=!0)})}),t})}),b.current.on("unread_count_update",e=>{f(e)}),S(),()=>{b.current&&b.current.disconnect()}},[e?.user?.id]);let S=async()=>{y(!0),w(null);try{let s=await fetch("/api/conversations");if(!s.ok)throw Error("Failed to fetch conversations");let a=await s.json();t(a);let n=a.reduce((s,t)=>s+t.messages.filter(s=>!s.read&&s.sender.id!==e?.user?.id).length,0);f(n),a.length>0&&!r&&m(a[0].id)}catch(e){console.error("Error fetching conversations:",e),w("Failed to load conversations. Please try again later."),o.toast.error("Failed to load conversations")}finally{y(!1)}},P=async e=>{if(e.preventDefault(),x.trim()&&r)try{let e=s.find(e=>e.id===r);if(!e)return;if(!(await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:x,conversationId:r,receiverId:e.doctor.id})})).ok)throw Error("Failed to send message");p(""),k()}catch(e){console.error("Error sending message:",e),o.toast.error("Failed to send message")}},C=async e=>{try{if(!(await fetch("/api/messages/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageIds:[e]})})).ok)throw Error("Failed to mark message as read")}catch(e){console.error("Error marking message as read:",e)}},k=()=>{setTimeout(()=>{j.current?.scrollIntoView({behavior:"smooth"})},100)};return((0,a.useEffect)(()=>{if(r){let t=s.find(e=>e.id===r);t&&t.messages.forEach(s=>{s.read||s.sender.id===e?.user?.id||C(s.id)}),k()}},[r,s]),v)?h.jsx("div",{className:"h-[calc(100vh-4rem)] flex items-center justify-center",children:h.jsx(c.Z,{size:"lg"})}):N?h.jsx("div",{className:"h-[calc(100vh-4rem)] flex items-center justify-center",children:(0,h.jsxs)("div",{className:"text-center",children:[h.jsx(d.K0,{message:N,type:"error"}),h.jsx("button",{onClick:S,className:"mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:"Try Again"})]})}):(0,h.jsxs)("div",{className:"flex h-[calc(100vh-4rem)]",children:[h.jsx(o.ToastContainer,{position:"top-right"}),(0,h.jsxs)("div",{className:"w-1/3 border-r flex flex-col",children:[h.jsx("div",{className:"p-4 border-b",children:(0,h.jsxs)("h2",{className:"text-xl font-semibold flex items-center",children:["Messages",g>0&&h.jsx("span",{className:"ml-2 bg-blue-500 text-white px-2 py-1 rounded-full text-sm",children:g})]})}),h.jsx("div",{className:"p-4",children:h.jsx(l.Z,{onConversationCreated:()=>{S()}})}),h.jsx("div",{className:"flex-1 overflow-y-auto",children:0===s.length?h.jsx("div",{className:"p-4 text-center text-gray-500",children:"No conversations yet. Start a new one!"}):s.map(s=>{let t=s.messages.filter(s=>!s.read&&s.sender.id!==e?.user?.id).length,a=s.messages[s.messages.length-1];return h.jsx("div",{className:`p-4 border-b cursor-pointer hover:bg-gray-50 ${r===s.id?"bg-gray-100":""}`,onClick:()=>m(s.id),children:(0,h.jsxs)("div",{className:"flex items-center",children:[h.jsx("img",{src:s.doctor.image||"/default-avatar.png",alt:s.doctor.name,className:"w-10 h-10 rounded-full mr-3"}),(0,h.jsxs)("div",{className:"flex-1",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center",children:[h.jsx("h3",{className:"font-medium",children:s.doctor.name}),a&&h.jsx("span",{className:"text-xs text-gray-500",children:(0,u.Sy)(a.createdAt)})]}),(0,h.jsxs)("div",{className:"flex justify-between items-center",children:[h.jsx("p",{className:"text-sm text-gray-500 truncate max-w-[180px]",children:a?.content||"No messages"}),t>0&&h.jsx("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:t})]})]})]})},s.id)})})]}),h.jsx("div",{className:"flex-1 flex flex-col",children:r?(0,h.jsxs)(h.Fragment,{children:[h.jsx("div",{className:"p-4 border-b",children:h.jsx("h2",{className:"text-xl font-semibold",children:s.find(e=>e.id===r)?.doctor.name})}),(0,h.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[s.find(e=>e.id===r)?.messages.length===0?h.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:"No messages yet. Start the conversation!"}):s.find(e=>e.id===r)?.messages.map(s=>h.jsx("div",{className:`mb-4 ${s.sender.id===e?.user?.id?"text-right":"text-left"}`,children:h.jsxs("div",{className:`inline-block p-3 rounded-lg max-w-[80%] ${s.sender.id===e?.user?.id?"bg-blue-500 text-white":"bg-gray-100"}`,onMouseEnter:()=>{s.read||s.sender.id===e?.user?.id||C(s.id)},children:[h.jsx("p",{className:"break-words",children:s.content}),h.jsxs("div",{className:"flex items-center justify-end mt-1 text-xs opacity-75 space-x-1",children:[h.jsx("span",{children:u.p6(s.createdAt)}),s.sender.id===e?.user?.id&&h.jsx("span",{className:"ml-1",children:s.read?"✓✓":"✓"})]})]})},s.id)),h.jsx("div",{ref:j})]}),h.jsx("form",{onSubmit:P,className:"p-4 border-t",children:(0,h.jsxs)("div",{className:"flex gap-2",children:[h.jsx("input",{type:"text",value:x,onChange:e=>p(e.target.value),placeholder:"Type a message...",className:"flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),h.jsx("button",{type:"submit",disabled:!x.trim(),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed",children:"Send"})]})})]}):h.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:"Select a conversation to start messaging"})})]})}[i,o,l,d]=m.then?(await m)():m,r()}catch(e){r(e)}})},5634:(e,s,t)=>{"use strict";function r(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function a(e){let s="string"==typeof e?new Date(e):e,t=Math.floor((new Date().getTime()-s.getTime())/1e3),r=Math.floor(t/31536e3);return r>=1?1===r?"1 year ago":`${r} years ago`:(r=Math.floor(t/2592e3))>=1?1===r?"1 month ago":`${r} months ago`:(r=Math.floor(t/86400))>=1?1===r?"1 day ago":`${r} days ago`:(r=Math.floor(t/3600))>=1?1===r?"1 hour ago":`${r} hours ago`:(r=Math.floor(t/60))>=1?1===r?"1 minute ago":`${r} minutes ago`:t<10?"just now":`${Math.floor(t)} seconds ago`}t.d(s,{Sy:()=>a,p6:()=>r})},6353:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{default:()=>m});var a=t(8416),n=t.n(a),i=t(215),o=t.n(i),l=t(1649),c=t(3590);t(8819),t(6764);var d=t(997),u=e([c]);c=(u.then?(await u)():u)[0];let x=["session"];function h(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),t.push.apply(t,r)}return t}function m(e){let{Component:s,pageProps:{session:t}}=e,r=o()(e.pageProps,x);return(0,d.jsxs)(l.SessionProvider,{session:t,children:[d.jsx(c.ToastContainer,{position:"top-right"}),d.jsx(s,function(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?h(Object(t),!0).forEach(function(s){n()(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}({},r))]})}r()}catch(e){r(e)}})},410:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{default:()=>h});var a=t(1649),n=t(1163),i=t(6689),o=t(1517),l=t(829),c=t(2691),d=t(997),u=e([o]);function h(){let{data:e,status:s}=(0,a.useSession)(),t=(0,n.useRouter)();return((0,i.useEffect)(()=>{"unauthenticated"===s&&t.push("/auth/signin")},[s,t]),"loading"===s)?d.jsx("div",{children:"Loading..."}):e?.user?d.jsx(c.Z,{allowedRoles:["patient"],children:d.jsx(l.Z,{children:(0,d.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[d.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Patient Dashboard"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[d.jsx("div",{className:"lg:col-span-2",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Messages"}),d.jsx(o.Z,{})]})}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),(0,d.jsxs)("div",{className:"space-y-4",children:[d.jsx("button",{className:"w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600",children:"Book Appointment"}),d.jsx("button",{className:"w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",children:"View Prescriptions"}),d.jsx("button",{className:"w-full bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600",children:"Medical History"})]})]})]})]})})}):null}o=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},4279:(e,s,t)=>{"use strict";t.d(s,{aC:()=>n}),t(8416);var r=t(6689);t(997);let a=(0,r.createContext)({isAuthenticated:!1,user:null,login:async()=>({success:!1}),logout:()=>{},register:async()=>({success:!1}),loading:!1,error:null,token:null});a.displayName="AuthContext";let n=()=>(0,r.useContext)(a)},7593:(e,s,t)=>{"use strict";t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{config:()=>g,default:()=>h,getServerSideProps:()=>p,getStaticPaths:()=>x,getStaticProps:()=>m,reportWebVitals:()=>f,routeModule:()=>w,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>N,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>b});var a=t(7093),n=t(5244),i=t(1323),o=t(4516),l=t.n(o),c=t(6353),d=t(410),u=e([c,d]);[c,d]=u.then?(await u)():u;let h=(0,i.l)(d,"default"),m=(0,i.l)(d,"getStaticProps"),x=(0,i.l)(d,"getStaticPaths"),p=(0,i.l)(d,"getServerSideProps"),g=(0,i.l)(d,"config"),f=(0,i.l)(d,"reportWebVitals"),b=(0,i.l)(d,"unstable_getStaticProps"),j=(0,i.l)(d,"unstable_getStaticPaths"),v=(0,i.l)(d,"unstable_getStaticParams"),y=(0,i.l)(d,"unstable_getServerProps"),N=(0,i.l)(d,"unstable_getServerSideProps"),w=new a.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/patient/dashboard",pathname:"/patient/dashboard",bundlePath:"",filename:""},components:{App:c.default,Document:l()},userland:d});r()}catch(e){r(e)}})},6764:()=>{},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},3590:e=>{"use strict";e.exports=import("react-toastify")},4612:e=>{"use strict";e.exports=import("socket.io-client")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},9796:e=>{"use strict";e.exports=require("zlib")}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[516,212],()=>t(7593));module.exports=r})();